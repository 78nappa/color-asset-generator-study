# カラーアセット作成システムの仕組み

## システム概要
デザインシステムやブランドカラーの管理のためのWebアプリケーション。ベースカラーから段階的な明度バリエーションを自動生成し、CSS変数として出力する。

## アーキテクチャの特徴

### **UI構成の二層構造**

#### カラー選択部分（静的HTML）
- **実装方式**: HTMLで事前に構造を記述
- **特徴**: 基本的なレイアウトとスタイルは固定
- **動的要素**: JavaScriptでカラー値の更新とイベント処理のみ

#### カラーパレット部分（動的生成）
- **実装方式**: JavaScriptでHTMLを完全に動的生成
- **特徴**: ベースカラーの変更に応じてリアルタイムで再構築
- **柔軟性**: カラー数や構成を自由に変更可能

## カラーパレット生成プロセス

### **1. 入力段階**
- ユーザーが16進数カラーコード（例：`#bd247b`）を入力
- カラーピッカーまたは直接入力で色を選択

### **2. 変換処理**
- **16進数 → RGB変換**: `#bd247b` → `{r: 189, g: 36, b: 123}`
- **RGB → 10進数**: 各色成分を0-255の10進数値として扱う

### **3. バリエーション生成**
- **明度調整**: 元の色を基準に6段階のバリエーションを作成
  - 100%（原色）
  - 70%、60%、50%、30%、10%（段階的に白に近づく）
- **計算方法**: 各RGB成分を白色（255）に向かって線形補間

### **4. パレット描画**
- 生成された各色をHTMLとして動的に構築
- カラープレビュー、パーセンテージ、16進数値を表示
- クリックでクリップボードにコピー機能

## 出力機能

### **CSS変数生成**
- **命名規則**: `--primary-100`, `--primary-70` など
- **形式**: 表示用（HTMLタグ付き）とコピー用（プレーンテキスト）の両方
- **日本語対応**: 「プライマリカラー」→「primary」の自動マッピング

### **リアルタイム更新**
- カラー変更時に全UIコンポーネントが即座に更新
- 状態管理による一元的なデータ管理
- パフォーマンスを考慮したレンダリング設計

## 技術的な特長

### **効率的な色彩計算**
- ビット演算を活用した高速なカラー変換
- 線形補間による自然な明度グラデーション
- 色値の範囲制限による安全な計算

### **実用性重視の設計**
- デザインシステムで一般的な6段階のバリエーション
- CSS変数として直接使用可能な出力形式
- 直感的なUI操作とリアルタイムプレビュー

このシステムは、静的HTMLと動的JavaScript生成を組み合わせることで、安定性と柔軟性を両立したカラーパレット管理ツールを実現している。

## script内容

### アプリケーションの状態管理

``` // アプリケーションの状態
        const state = {
            baseColors: [
                { name: 'ベースカラー', hex: '#bd247b' },
                { name: 'プライマリカラー', hex: '#3bf761' },
                { name: 'セカンダリカラー', hex: '#3bf7d1' },
                { name: 'アクセントカラー', hex: '#f7613b' }
            ],
            presetColors: [
                '#bd247b', '#34495e', '#e74c3c', '#27ae60',
                '#3498db', '#f39c12', '#9b59b6', '#1abc9c'
            ],
            cssString: '', // プレーンテキストのCSS文字列を保存
            version: '1.0.0' // バージョン番号
        };
```

#### 各プロパティの役割

##### baseColors配列
- **目的**: メインで使用する基本カラーの情報を保存
- **構造**: 各カラーは`name`（日本語名）と`hex`（16進数カラーコード）のペア
- **初期値**: 4色のデフォルトカラーが設定済み
- **用途**: カラーパレット生成の元となるデータ

##### presetColors配列　<small>*UI未実装*</small>
- **目的**: よく使われるカラーのプリセット集
- **構造**: 16進数カラーコードの配列
- **用途**: ユーザーがワンクリックで選択できる定番カラー（8色）

##### cssString文字列
- **目的**: 生成されたCSS変数をプレーンテキストで保存
- **初期値**: 空文字列
- **用途**: コピー機能で使用（HTMLタグを含まない純粋なCSS文字列）

##### version文字列
- **目的**: アプリケーションのバージョン情報
- **用途**: フッター部分での表示

#### 状態管理の仕組み

##### **中央集権的データ管理**
- アプリケーション全体のデータを一箇所に集約
- 複数のUIコンポーネント間でデータを共有

##### **リアクティブ更新**
- `state`オブジェクトが変更されると、`renderAll()`関数で全UIが更新
- データの変更とUI更新のタイミングを制御

##### **初期化とデフォルト値**
- アプリケーション起動時の初期状態を定義
- ユーザーが何も操作しなくても、すぐに使える状態を提供

この設計により、データの整合性を保ちながら、アプリケーション全体の状態を効率的に管理しています。

#### stateオブジェクトの構造

**state変数**は1つのオブジェクトで、その中に**複数の異なるデータ型**が含まれています

- `state`は**オブジェクト**
- その中に**2つの配列と2つの文字列**が**プロパティ**として格納されている

##### **データ構造のイメージ**

```
state（オブジェクト）
├── baseColors（オブジェクトの配列）
├── presetColors（文字列の配列）  
├── cssString（文字列）
└── version（文字列）
```

### 16進数のカラーコードをRGBの数値に変換

``` // 16進数カラーからRGBに変換
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }
``` 


#### 処理の流れ

##### **1. 正規表現でパターンマッチング**
```正規表現オブジェクト（RegExpオブジェクト）
/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i
```

**正規表現の意味：**
- `^` : 文字列の開始
- `#?` : #記号（あってもなくてもOK）
- `([a-f\d]{2})` : 16進数文字2桁をキャプチャ（3回繰り返し）
  - `a-f` : a～fの文字
  - `\d` : 0～9の数字
  - `{2}` : 2桁
- `$` : 文字列の終了
- `i` : 大文字小文字を区別しない

##### **正規表現が持つメソッド**
- `.exec()` - マッチした結果を詳細に取得
- `.test()` - マッチするかどうかのboolean判定
- `.match()` - 文字列側から呼び出すマッチメソッド

##### 使用パターンの比較

### **1. .exec()を使った場合（今回のコード）**
```javascript
const result = /正規表現/.exec(文字列);
```

### **2. .test()を使った場合**
```javascript
const isValid = /正規表現/.test(文字列);  // true/falseのみ
```

### **3. 文字列側から呼び出す場合**
```javascript
const result = 文字列.match(/正規表現/);
```

##### **2. 文字列の分解**
- `result[1]` : 赤の成分（RR）
- `result[2]` : 緑の成分（GG）  
- `result[3]` : 青の成分（BB）

##### **3. 16進数→10進数変換**
```javascript
parseInt(result[1], 16)  // 16進数を10進数に変換
```

##### parseInt()の仕組み

##### **基本構文**
```javascript
parseInt(文字列, 基数)
```

##### **第2引数（基数）の意味**
- **16** = 入力される文字列を「16進数として解釈」する

**第2引数は「入力の基数」、出力は常に10進数の数値**になります。

##### **4. 戻り値**
- **成功時**: `{r: 数値, g: 数値, b: 数値}` のオブジェクト
- **失敗時**: `null`